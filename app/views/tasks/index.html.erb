<%= simple_form_for :search, url: tasks_path, method: :get do |f| %>
  <div class="form-group d-flex flex-row">
    <div class="d-flex flex-column">
      <% categories_for_select = current_user.categories.to_a %>
      <% categories_for_select << OpenStruct.new(name: 'All', id: 'all') %>
      <% priorities_for_select = Task.priorities.keys.map { |p| OpenStruct.new(name: p.capitalize, id: p) } %>
      <% priorities_for_select << OpenStruct.new(name: 'All', id: 'all') %>
    <div class="d-flex flex-row h-100">
      <div>
        <input class="form-control string required" type="text" name="search[query]" id="search_query" value="<%= params.dig(:search, :query) %>", placeholder="Enter task name"/>
      </div>
        <%= f.input :category, as: :select, collection: categories_for_select, label: false, prompt: "Category", include_blank: false, required: false, selected: params.dig(:search, :category)%>
        <%= f.input :priority, as: :select, collection: priorities_for_select, label: false, prompt:"Priority",include_blank: false, required: false, selected: params.dig(:search, :priority) %>
        <%= f.submit 'Search', class: "btn-search" %>
      </div>
<% end %>
<%= link_to tasks_without_date_tasks_path, class: "text-black-50" do %>
  <h4 class="m-3">Tasks with no dates assigned</h4>
<% end %>
<% @tasks_without_due_date.each do |task| %>
  <div class='card task-card'>
    <div class='d-flex flex-row justify-content-between'>
      <div>
        <%= render 'priority_dot', task: task %>
        <%= link_to task_path(task) do %>
          <%= task.title %>
        <% end %>
      </div>
      <%= render 'toggle_completed', task: task %>
    </div>
    <p style="font-size: 14px"> <%= task.description %> </p>
  </div>
<% end %>

<% @tasks_grouped_by_dates.each_with_index do |tasks, index| %>
  <%= link_to dates_task_path(tasks[0]), class: "text-black-50" do %>
    <h4><%= @dates[index] %></h4>
  <% end %>
  <% tasks.each do |task| %>
    <div class='card task-card'>
      <div class='d-flex flex-row justify-content-between'>
        <div>
          <%= render 'priority_dot', task: task %>
          <%= link_to task_path(task) do %>
            <%= task.title %>
          <% end %>
        </div>
        <%= render 'toggle_completed', task: task %>
      </div>
      <p style="font-size: 14px"> <%= task.description %> </p>
    </div>
  <% end %>
<% end %>
